<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Google Fonts untuk tampilan yang lebih baik -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Gaya kustom untuk melengkapi Tailwind */
        body {
            font-family: 'Inter', sans-serif;
        }
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem; /* Jarak antar tombol */
        }
        .btn {
            @apply text-3xl font-medium p-4 rounded-xl shadow-lg transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800;
        }
        /* Styling untuk berbagai jenis tombol */
        .btn-number {
            @apply bg-gray-600 text-white hover:bg-gray-500 active:bg-gray-700;
        }
        .btn-operator {
            @apply bg-yellow-500 text-white hover:bg-yellow-400 active:bg-yellow-600 focus:ring-yellow-500;
        }
        .btn-special {
            @apply bg-gray-400 text-black hover:bg-gray-300 active:bg-gray-500 focus:ring-gray-400;
        }
        .span-two {
            grid-column: span 2;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-xs sm:max-w-sm mx-auto bg-gray-800 rounded-2xl shadow-2xl p-5">
        <!-- Layar Tampilan Kalkulator -->
        <div id="display" class="bg-gray-900 text-white text-6xl text-right rounded-lg mb-5 p-4 overflow-hidden break-words h-24 flex items-end justify-end">
            <span id="display-value">0</span>
        </div>

        <!-- Tombol-tombol -->
        <div class="calculator-grid">
            <!-- Baris 1 -->
            <button data-action="clear" class="btn btn-special">AC</button>
            <button data-action="delete" class="btn btn-special">DEL</button>
            <button data-operator="%" class="btn btn-special">%</button>
            <button data-operator="/" class="btn btn-operator">÷</button>

            <!-- Baris 2 -->
            <button data-number="7" class="btn btn-number">7</button>
            <button data-number="8" class="btn btn-number">8</button>
            <button data-number="9" class="btn btn-number">9</button>
            <button data-operator="*" class="btn btn-operator">×</button>

            <!-- Baris 3 -->
            <button data-number="4" class="btn btn-number">4</button>
            <button data-number="5" class="btn btn-number">5</button>
            <button data-number="6" class="btn btn-number">6</button>
            <button data-operator="-" class="btn btn-operator">−</button>

            <!-- Baris 4 -->
            <button data-number="1" class="btn btn-number">1</button>
            <button data-number="2" class="btn btn-number">2</button>
            <button data-number="3" class="btn btn-number">3</button>
            <button data-operator="+" class="btn btn-operator">+</button>

            <!-- Baris 5 -->
            <button data-number="0" class="btn btn-number span-two">0</button>
            <button data-number="." class="btn btn-number">.</button>
            <button data-action="equals" class="btn btn-operator">=</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.getElementById('display-value');
            const buttons = document.querySelector('.calculator-grid');

            let currentInput = '0';
            let previousInput = null;
            let operator = null;
            let shouldResetDisplay = false;

            // Fungsi untuk memperbarui tampilan
            const updateDisplay = () => {
                display.textContent = formatNumber(currentInput);
            };
            
            // Fungsi untuk memformat angka (misalnya, menambahkan pemisah ribuan)
            const formatNumber = (numberString) => {
                if (numberString === '' || numberString === '-') return numberString;
                const [integerPart, decimalPart] = numberString.split('.');
                const formattedInteger = parseFloat(integerPart).toLocaleString('id-ID', { maximumFractionDigits: 0 });
                return decimalPart !== undefined ? `${formattedInteger},${decimalPart}` : formattedInteger;
            };

            // Event listener utama untuk semua tombol
            buttons.addEventListener('click', (event) => {
                const { target } = event;
                const { dataset } = target;

                if (!target.matches('button')) return;

                if (dataset.number) {
                    handleNumber(dataset.number);
                } else if (dataset.operator) {
                    handleOperator(dataset.operator);
                } else if (dataset.action) {
                    handleAction(dataset.action);
                }
                
                updateDisplay();
            });

            const handleNumber = (number) => {
                if (currentInput === '0' || shouldResetDisplay) {
                    currentInput = number;
                    shouldResetDisplay = false;
                } else {
                    currentInput += number;
                }

                if (number === '.' && currentInput.split('.').length > 2) {
                    currentInput = currentInput.slice(0, -1);
                }
            };

            const handleOperator = (nextOperator) => {
                if (operator && !shouldResetDisplay) {
                    calculate();
                    updateDisplay();
                }
                
                previousInput = currentInput;
                operator = nextOperator;
                shouldResetDisplay = true;
            };

            const handleAction = (action) => {
                switch (action) {
                    case 'clear':
                        resetCalculator();
                        break;
                    case 'delete':
                        deleteLastDigit();
                        break;
                    case 'equals':
                        calculate();
                        operator = null; // Reset operator setelah perhitungan
                        break;
                }
            };
            
            const calculate = () => {
                if (!operator || previousInput === null) return;
                
                let result = 0;
                const prev = parseFloat(previousInput.replace(',', '.'));
                const current = parseFloat(currentInput.replace(',', '.'));

                if (isNaN(prev) || isNaN(current)) return;

                switch (operator) {
                    case '+': result = prev + current; break;
                    case '-': result = prev - current; break;
                    case '*': result = prev * current; break;
                    case '/': 
                        if (current === 0) {
                           alert("Error: Tidak bisa membagi dengan nol.");
                           resetCalculator();
                           return;
                        }
                        result = prev / current; 
                        break;
                    case '%': result = prev % current; break;
                }
                
                currentInput = result.toString().replace('.', ',');
                shouldResetDisplay = true;
                previousInput = null;
            };

            const resetCalculator = () => {
                currentInput = '0';
                previousInput = null;
                operator = null;
                shouldResetDisplay = false;
            };

            const deleteLastDigit = () => {
                if (currentInput.length > 1) {
                    currentInput = currentInput.slice(0, -1);
                } else {
                    currentInput = '0';
                }
            };

            updateDisplay();
        });
    </script>
</body>
</html>